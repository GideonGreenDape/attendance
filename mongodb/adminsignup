const { MongoClient } = require('mongodb');
require('dotenv').config();

const url = process.env.CONNECTION_URI;
const client = new MongoClient(url);
const dbName = 'MvcCohort';
const document = 'admin';

async function AdminSignUp(username, password, role = 'admin') {
    try {
        await client.connect();
        console.log('Admin Signup DB logic connected to MongoDb Database');
        const db = client.db(dbName);
        const collection = db.collection(document);

        // Check if username already exists
        const existingAdmin = await collection.findOne({ username: username });
        if (existingAdmin) {
            console.log('Username already exists.');
            return { success: false, message: 'Username already exists' };
        }

        // Insert new admin
        const result = await collection.insertOne({ username, password, role });
        if (result.insertedId) {
            return { 
                success: true,
                username,
                role 
            };
        } else {
            return { success: false, message: 'Signup failed' };
        }
    } catch (err) {
        console.log(err);
        return { success: false, message: 'Error during signup' };
    } finally {
        await client.close();
        console.log('Admin Signup DB logic closed connection to MongoDb Database');
    }
}

module.exports = AdminSignUp;
